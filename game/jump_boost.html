<!DOCTYPE html>
<html>
<body>
<canvas id='c' width='400' height='400'></canvas>


<script>
function elem(x){return document.getElementById(x)}
var ca=elem('c')
var ctx=ca.getContext('2d')
var tolist=(x)=>typeof(x)=='number'?[x]:x
function add(x,y){var x1=tolist(x);y1=tolist(y);x2=x1.length;y2=y1.length;var x3=[];for(i=0;i<max(x2,y2);i++){x3[i]=x1[min(i,x2-1)]+y1[min(1,y2-1)]};return x3}
var min=(x,y)=>x>y?y:x
var max=(x,y)=>x>y?x:y
function subt(x,y){var x1=tolist(x);y1=tolist(y);x2=x1.length;y2=y1.length;var x3=[];for(i3=0;i3<max(x2,y2);i3++){x3[i3]=x1[min(i3,x2-1)]-y1[min(i3,y2-1)]};return x3}
var sin=(x)=>Math.sin(x)
var cos=(x)=>Math.cos(x)
var sqrt=(x)=>Math.sqrt(x)
function mult(x,y){var x1=tolist(x);x2=x1.length;var x3=[];for(i4=0;i4<x2;i4++){x3[i4]=x1[min(i4,x2-1)]*y};return x3}
function list(x,y,x1){var y1=[];for(i=0;i<x1;i++){y1[i]=x+i*y};return y1}
function Min(x){var y=Infinity;for(i2=0;i2<x.length;i2++){if(x[i2]<y){y=x[i2]}};return y}
function setrgb(x,y,z){ctx.fillStyle='rgb('+x+','+y+','+z+')'}
function overx(x,y,x1,b){var x2=[0];i1=0;for(i=0;i<x.length;i++){if(b){if(y[i]>x1){x2[i1]=x[i];i1+=1}}else{if(y[i]<x1){x2[i1]=x[i];i1+=1}}};return x2}
var und=(x)=>{if(x!=undefined){return x}else{return []}}
var xp=0;yp=6;ca=0;a=0;ps=0.3;F=1;gr=1;jb=2;g=0;v=0.5;pv=1;w=5;B=6;dt=0.05
function u1(){a+=dt}
var P=()=>[xp,yp]
var sp=(x)=>(v*a)%x<v*dt
var M=(x)=>sqrt(x[0]*x[0]+x[1]*x[1])
var D=(x,y)=>M([x[0]-y[0],x[1]-y[1]])
function tr(x){return (x+B)*200/B}
function tr1(x){return (-x+B)*200/B}
var Tr=(x)=>{var x1=[x[0],x[1]-ca];return [tr(T(x)[0]),tr1(T(x)[1])]}
function u2(){ca+=dt*V()}
function gp(x,y){var z=[];for(i=0;i<x.length;i++){z[i]=[x[i],y[i]]};return z}
function cl(x,y){var z=[];for(i=0;i<y;i++){z[i]=x};return z}
var rdm=(x)=>!x?[]:[w*(2*Math.random()-1)].concat(rdm(x-1))
var Sq=(x,y)=>sq([x[0]-y[0],x[1]-y[1]])
function Y(x){var z=[];for(i=0;i<x.length;i++){z[i]=x[i][1]};return z}
function ins(xx,yy){var z1=10;for(i0=0;i0<xx.length;i0++){z1=min(z1,Sq(xx[i0],yy))};return z1<ps}
var gw=(x)=>gp(rdm(x),cl(B+ca,x))
var P1=[];F1=2;v1=2;T1=5;t1=5;n1=2
var P2=[];F2=2.5;v2=2;T2=5;t2=5;n2=2
var P3=[];F3=2.8;v3=2;T3=5;t3=5;n3=2
var P4=[];F4=2.2;v4=2;T4=5;t4=5;n4=2
var P5=[];F5=2.9;j5=2;T5=5;t5=5;n5=2
var P6=[[0,7]];F6=3.2;T6=5;t6=7;n6=2
var sq=(x)=>max(A(x[0]),A(x[1]))
var A=(x)=>x>0?x:-x
function us1(){if(sp(F1)){P1=P1.concat(gw(n1))}}
function ud1(){P1=overx(P1,Y(P1),ca-B,true)}
function ua1(){if(ins(P1,P())){t1=0};t1=min(t1+dt,T1)}

function us2(){if(sp(F2)){P2=P2.concat(gw(n2))}}
function ud2(){P2=overx(P2,Y(P2),ca-B,true)}
function ua2(){if(ins(P2,P())){t2=0};t2=min(t2+dt,T2)}
var V=()=>v*(t1<T1?v1:1)/(t2<T2?v2:1)
var pV=()=>pv*(t3<T3?v3:1)/(t4<T4?v4:1)

function us3(){if(sp(F3)){P3=P3.concat(gw(n3))}}
function ud3(){P3=overx(P3,Y(P3),ca-B,true)}
function ua3(){if(ins(P3,P())){t3=0};t3=min(t3+dt,T3)}

function us4(){if(sp(F4)){P4=P4.concat(gw(n4))}}
function ud4(){P4=overx(P4,Y(P4),ca-B,true)}
function ua4(){if(ins(P4,P())){t4=0};t4=min(t4+dt,T4)}

function us5(){if(sp(F5)){P5=P5.concat(gw(n5))}}
function ud5(){P5=overx(P5,Y(P5),ca-B,true)}
function ua5(){if(ins(P5,P())){t5=0};t5=min(t5+dt,T5)}
var Jb=()=>jb*(t5<T5?j5:1)
var Pw=[[0,B-ps]];nw=2;lw=2

function ud6(){P6=overx(P6,Y(P6),ca-B,true)}
function us6(){if(sp(F6)){P6=P6.concat(gw(n6))}}

function usw(){if(sp(F)){Pw=Pw.concat(gw(nw))}}
function udw(){Pw=overx(Pw,Y(Pw),ca-B,true)}
var dL=function(x){return A(x[0]-xp)>lw/2+ps?10:x[1]-yp}
function pSt(){var x=0;for(j=0;j<Pw.length;j++){var y=dL(Pw[j]);if(y<=0&&y>=-ps){x=1;break}else if(y>=0&&y<=ps){x=2;break}};return x}
var xd=0;yd=0;vp=0
var cla=(x,y,t)=>min(y,max(x,t))
function upx(){xp=cla(ps-w,w-ps,xp+pV()*dt*xd)}
function upy(){yp=(pSt()==1&&vp<0)||(pSt()==2&&vp>0)?yp:yp+dt*vp}
function upv(){vp=(pSt()==1&&vp<0)||(pSt()==2&&vp>0)?0:vp-gr*dt}
function up(){upx();upv();upy()}
function lerp(x,y,t){return add(x,mult(subt(y,x),t))}
function fun(x){return min(1,1+T6/2-A(x-1-T6/2))}
var ln=(x)=>Math.log(E,x)
var E=Math.E //transformation preparation
var sgn=(x)=>!x?0:(x>0?1:-1)
var sh=(x)=>(E**x-E**(-x))/2
var ch=(x)=>(E**x+E**(-x))/2
var g1=(x)=>[x[0]*x[0]-x[1]*x[1],2*x[0]*x[1]]
var g2=(x)=>[sqrt((M(x)+x[0])/2),sgn(x[1])*sqrt((M(x)-x[0])/2)]
var g3=(x)=>[sin(x[0])*ch(x[1]),cos(x[0])*sh(x[1])]
var g4=(x)=>{var y=(x[0]-1)*(x[0]-1)+x[1]*x[1];return [-2*x[1]/y,(x[0]*x[0]+x[1]*x[1]-1)/y]}
var g5=(x)=>mult([cos(x[1]),sin(x[1])],E**x[0])
var g6=(x)=>[ln(M(x)),Math.atan2(x[1],x[0])]
var g7=(x)=>mult([x[0],-x[1]],w/(x[0]*x[0]+x[1]*x[1]))
var g8=(x)=>g7(g3(x))
var I6=1
function Tt(x){var y;switch(I6){
case 1:y=g1(x);break
case 2:y=g2(x);break
case 3:y=g3(x);break
case 4:y=g4(x);break
case 5:y=g5(x);break
case 6:y=g6(x);break
case 7:y=g7(x);break
case 8:y=g8(x);break
default:y=x;break
}
y=lerp(x,y,fun(t6))
return y}

function T(x){return Tt([x[0],x[1]-ca])}
function u3(){if(t6==2+T6){I6=Math.floor(8*Math.random())+1}}
function ua6(){if(ins(P6,P())){t6=min(t6,2+T6-t6)};t6=min(t6+dt,2+T6)}
var cj=()=>pSt()==1
function J(){if(yd==1&&cj()){vp+=jb}}
function ua(){ua1();ua2();ua3();ua4();ua5();ua6()}
function ud(){ud1();ud2();ud3();ud4();ud5();ud6();udw()}
function us(){us1();us2();us3();us4();us5();us6();usw()}
function game(){if(g==0){u1();u3();ua();J();up()};u2();ud();us();plot()}

function rect(x){ctx.fillRect(x[0],x[1],1,1)}
var st=400;St=100;Ps=3
var p1=(x,t)=>[x[0]+lw*(t-0.5),x[1]]
function p2(x){for(t=0;t<1;t+=1/st){rect(Tr(p1(x,t)))}}
function Px(){Pw.forEach(p2)}
function p3(){for(i5=0;i5<ps;i5+=ps/St){for(j5=0;j5<ps;j5+=ps/St){rect(Tr([i5*2+xp-ps,j5*2+yp-ps]))}}}
var p4=(x,t)=>[x[0],ca+B*(2*t-1)]
function p5(x){for(t=0;t<1;t+=1/st){rect(Tr(p4(x,t)))}}
function Py(){[[-w,0],[w,0]].forEach(p5)}
function point(x){ctx.beginPath();ctx.arc(x[0],x[1],Ps,0,2*Math.PI);ctx.fill()}
function Point(x){x.map(Tr).forEach(point)}
function plot(){ctx.clearRect(0,0,400,400);setrgb(0,0,0);Px();Py();p3();
setrgb(255,128,0);Point(P1)
setrgb(128,128,0);Point(P2)
setrgb(0,0,255);Point(P3)
setrgb(128,128,128);Point(P4)
setrgb(0,255,0);Point(P5)
setrgb(255,0,255);Point(P6)
}
setInterval(game,1000*dt)
document.onkeydown=function(event){var event=event||window.event;x=event.keyCode;
if(x==37){xd=-1};if(x==39){xd=1};if(x==38){yd=1}}
document.onkeyup=function(event){var event=event||window.event;x=event.keyCode;
if(x==37){xd=0};if(x==39){xd=0};if(x==38){yd=0}}
</script>

</body>
</html>
